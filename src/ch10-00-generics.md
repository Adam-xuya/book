# 泛型类型、Trait 和生命周期

每种编程语言都有有效处理概念重复的工具。在 Rust 中，其中一个工具是 _泛型_：具体类型或其他属性的抽象占位符。我们可以表达泛型的行为或它们如何与其他泛型相关，而无需知道在编译和运行代码时它们的位置将是什么。

函数可以接受某些泛型类型的参数，而不是像 `i32` 或 `String` 这样的具体类型，就像它们接受具有未知值的参数以在多个具体值上运行相同代码一样。事实上，我们在第 6 章使用 `Option<T>`，在第 8 章使用 `Vec<T>` 和 `HashMap<K, V>`，在第 9 章使用 `Result<T, E>` 时已经使用了泛型。在本章中，你将探索如何使用泛型定义自己的类型、函数和方法！

首先，我们将回顾如何提取函数以减少代码重复。然后，我们将使用相同的技术从两个仅在参数类型上不同的函数中创建一个泛型函数。我们还将解释如何在结构体和枚举定义中使用泛型类型。

然后，你将学习如何使用 trait 以泛型方式定义行为。你可以将 trait 与泛型类型结合使用，以将泛型类型限制为仅接受具有特定行为的类型，而不是仅仅任何类型。

最后，我们将讨论 _生命周期_：一种泛型，它向编译器提供有关引用如何相互关联的信息。生命周期允许我们向编译器提供关于借用值的足够信息，以便它可以确保引用在更多情况下有效，而不是在没有我们帮助的情况下可以确保的情况。

## 通过提取函数消除重复

泛型允许我们用代表多种类型的占位符替换特定类型以消除代码重复。在深入了解泛型语法之前，让我们首先看看如何通过提取函数来消除重复，该函数用代表多个值的占位符替换特定值。然后，我们将应用相同的技术来提取泛型函数！通过查看如何识别可以提取到函数中的重复代码，你将开始识别可以使用泛型的重复代码。

我们将从代码清单 10-1 中的简短程序开始，该程序在列表中查找最大数字。

<Listing number="10-1" file-name="src/main.rs" caption="在数字列表中查找最大数字">

```rust
{{#rustdoc_include ../listings/ch10-generic-types-traits-and-lifetimes/listing-10-01/src/main.rs:here}}
```

</Listing>

我们将整数列表存储在变量 `number_list` 中，并将列表中第一个数字的引用放在名为 `largest` 的变量中。然后，我们遍历列表中的所有数字，如果当前数字大于存储在 `largest` 中的数字，我们替换该变量中的引用。但是，如果当前数字小于或等于到目前为止看到的最大数字，变量不会更改，代码继续到列表中的下一个数字。在考虑列表中的所有数字之后，`largest` 应该引用最大数字，在这种情况下是 100。

现在我们已经接到任务，要在两个不同的数字列表中找到最大数字。为此，我们可以选择复制代码清单 10-1 中的代码，并在程序的两个不同位置使用相同的逻辑，如代码清单 10-2 所示。

<Listing number="10-2" file-name="src/main.rs" caption="在两个数字列表中查找最大数字的代码">

```rust
{{#rustdoc_include ../listings/ch10-generic-types-traits-and-lifetimes/listing-10-02/src/main.rs}}
```

</Listing>

尽管这段代码有效，但复制代码很繁琐且容易出错。当我们想要更改它时，我们还必须记住在多个地方更新代码。

为了消除这种重复，我们将通过定义一个函数来创建一个抽象，该函数对作为参数传递的任何整数列表进行操作。这个解决方案使我们的代码更清晰，让我们抽象地表达在列表中查找最大数字的概念。

在代码清单 10-3 中，我们将查找最大数字的代码提取到名为 `largest` 的函数中。然后，我们调用该函数来查找代码清单 10-2 中两个列表的最大数字。我们也可以在未来可能拥有的任何其他 `i32` 值列表上使用该函数。

<Listing number="10-3" file-name="src/main.rs" caption="抽象代码以在两个列表中查找最大数字">

```rust
{{#rustdoc_include ../listings/ch10-generic-types-traits-and-lifetimes/listing-10-03/src/main.rs:here}}
```

</Listing>

`largest` 函数有一个名为 `list` 的参数，它代表我们可能传递给函数的任何具体 `i32` 值切片。因此，当我们调用函数时，代码在我们传递的特定值上运行。

总结一下，以下是我们将代码从代码清单 10-2 更改为代码清单 10-3 的步骤：

1. 识别重复代码。
1. 将重复代码提取到函数体中，并在函数签名中指定该代码的输入和返回值。
1. 更新重复代码的两个实例以调用函数。

接下来，我们将使用这些相同的步骤和泛型来减少代码重复。就像函数体可以在抽象 `list` 上操作而不是在特定值上操作一样，泛型允许代码在抽象类型上操作。

例如，假设我们有两个函数：一个在 `i32` 值切片中查找最大项，另一个在 `char` 值切片中查找最大项。我们如何消除这种重复？让我们找出答案！
